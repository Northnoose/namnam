---
phase: 04-seo-and-meta
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
autonomous: true
requirements:
  - SEO-01
  - SEO-02
  - SEO-03
  - SEO-05

must_haves:
  truths:
    - "Browser tab shows 'Nam Nam Pizza & Grill – Pizza, Grill & Burger i Åmot | Utkjøring i Modum'"
    - "Sharing the URL on social media renders a preview card with title, description, and logo image"
    - "Browser dev tools show a valid <script type='application/ld+json'> block with FastFoodRestaurant type, address, telephone, and opening hours"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "metadata export with title, description, openGraph + JSON-LD script tag in RootLayout JSX"
      contains: "FastFoodRestaurant"
  key_links:
    - from: "src/app/layout.tsx"
      to: "metadata.openGraph.images"
      via: "metadataBase URL resolution"
      pattern: "metadataBase.*namnam\\.no"
    - from: "src/app/layout.tsx"
      to: "JSON-LD script"
      via: "dangerouslySetInnerHTML in RootLayout JSX"
      pattern: "application/ld\\+json"
---

<objective>
Update layout.tsx to export a complete `metadata` object (title, description, Open Graph) and inject a JSON-LD LocalBusiness script tag into the RootLayout JSX.

Purpose: Search engines and social platforms can correctly identify the business and render a preview card when the URL is shared.
Output: Updated `src/app/layout.tsx` with full SEO metadata and structured data.
</objective>

<execution_context>
@/Users/steffen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/steffen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-seo-and-meta/04-RESEARCH.md
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add metadata export and JSON-LD script to layout.tsx</name>
  <files>src/app/layout.tsx</files>
  <action>
Replace the existing placeholder `metadata` export and add a JSON-LD script block to `src/app/layout.tsx`.

**Step 1 — Replace the metadata export (currently `title: "[COMPANY_NAME]"`):**

```typescript
export const metadata: Metadata = {
  metadataBase: new URL(
    process.env.NEXT_PUBLIC_SITE_URL ?? "https://namnam.no"
    // TODO: update NEXT_PUBLIC_SITE_URL env var with confirmed deployment domain before go-live
  ),
  title: "Nam Nam Pizza & Grill – Pizza, Grill & Burger i Åmot | Utkjøring i Modum",
  description:
    "Gatekjøkkenet i Åmot – Fastfood som du ønsker, når du ønsker! Ring 41 23 22 19 og bestill pizza, grill eller burger med utkjøring i Modum.",
  openGraph: {
    title: "Nam Nam Pizza & Grill – Pizza, Grill & Burger i Åmot | Utkjøring i Modum",
    description:
      "Gatekjøkkenet i Åmot – Fastfood som du ønsker, når du ønsker! Ring 41 23 22 19 og bestill pizza, grill eller burger med utkjøring i Modum.",
    images: [
      {
        url: "/img/NamNamPizza&Grill.png",
        width: 1024,
        height: 1024,
        alt: "Nam Nam Pizza & Grill logo",
      },
    ],
    locale: "nb_NO",
    type: "website",
  },
};
```

**Step 2 — Add JSON-LD const before the RootLayout function (but after the metadata export):**

```typescript
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "FastFoodRestaurant",
  name: "Nam Nam Pizza & Grill",
  description:
    "Gatekjøkkenet i Åmot – pizza, grill og burger med utkjøring i Modum.",
  address: {
    "@type": "PostalAddress",
    streetAddress: "Strandgata 11",
    addressLocality: "Åmot",
    postalCode: "3340",
    addressCountry: "NO",
  },
  telephone: "+4741232219",
  openingHours: "Mo-Su 13:00-23:00",
  url: "https://namnam.no",
  servesCuisine: ["Pizza", "Grill", "Burger"],
};
```

**Step 3 — In the RootLayout JSX, add the script tag directly inside `<html>` before `<body>` (or inside `<body>` after ThemeProvider is acceptable — both render server-side):**

Place `<script>` tag inside `<html>` before `<body>`:
```tsx
<html lang="nb" suppressHydrationWarning data-scroll-behavior="smooth">
  <script
    type="application/ld+json"
    dangerouslySetInnerHTML={{
      __html: JSON.stringify(jsonLd).replace(/</g, "\\u003c"),
    }}
  />
  <body className={inter.className}>
    ...
  </body>
</html>
```

**Critical rules (from RESEARCH.md pitfalls):**
- `metadataBase` MUST be set — without it, relative OG image URL causes a Next.js build error
- `.replace(/</g, "\\u003c")` XSS sanitization is REQUIRED on the JSON.stringify output
- `openingHours: "Mo-Su 13:00-23:00"` — exactly this format (two-letter codes, 24h, no spaces around colon)
- Do NOT use `metadata.icons` config — favicon is handled separately via file-based convention in Plan 02
- The `import type { Metadata } from "next"` import is already present in layout.tsx — do not add a duplicate
  </action>
  <verify>
    <automated>cd /Users/steffen/Desktop/Projects/website_template && npm run build 2>&1 | tail -20</automated>
    <manual>After build: check .next/server/app/index.html or run `npm run dev` and view-source — confirm title tag contains "Nam Nam Pizza" and og:image meta tag is present</manual>
    <sampling_rate>run after this task, before proceeding to Plan 03</sampling_rate>
  </verify>
  <done>
    - `npm run build` exits 0 (no metadataBase or TypeScript errors)
    - `src/app/layout.tsx` contains the full metadata export with title, description, openGraph, and metadataBase
    - `src/app/layout.tsx` contains a `<script type="application/ld+json">` tag with dangerouslySetInnerHTML
    - The jsonLd object includes "@type": "FastFoodRestaurant", correct Norwegian address, "+4741232219" telephone, "Mo-Su 13:00-23:00" openingHours
  </done>
</task>

</tasks>

<verification>
Run `npm run build` and confirm exit code 0. Spot-check the generated HTML:
```bash
grep -r "Nam Nam Pizza" .next/server/app/ | head -5
grep -r "FastFoodRestaurant" .next/server/app/ | head -5
grep -r "og:title" .next/server/app/ | head -5
```
</verification>

<success_criteria>
- `npm run build` passes without errors or warnings about metadataBase or metadata types
- Browser tab title is "Nam Nam Pizza & Grill – Pizza, Grill & Burger i Åmot | Utkjøring i Modum" (verified in Plan 03 checkpoint)
- `<meta property="og:title">`, `<meta property="og:description">`, `<meta property="og:image">` are present in page HTML
- `<script type="application/ld+json">` is present with FastFoodRestaurant type, Norwegian address, correct telephone and openingHours
</success_criteria>

<output>
After completion, create `.planning/phases/04-seo-and-meta/04-01-SUMMARY.md`
</output>
