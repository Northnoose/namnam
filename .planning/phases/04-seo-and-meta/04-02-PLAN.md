---
phase: 04-seo-and-meta
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/icon.tsx
  - src/app/apple-icon.tsx
autonomous: true
requirements:
  - SEO-04

must_haves:
  truths:
    - "Browser tab displays the Nam Nam logo as favicon (not a generic icon)"
    - "Adding the page to an iPhone home screen shows the Nam Nam logo as the app icon"
  artifacts:
    - path: "src/app/icon.tsx"
      provides: "Next.js file-based favicon generation via ImageResponse (32x32)"
      exports: ["default", "size", "contentType"]
    - path: "src/app/apple-icon.tsx"
      provides: "Next.js file-based Apple touch icon generation via ImageResponse (180x180)"
      exports: ["default", "size", "contentType"]
  key_links:
    - from: "src/app/icon.tsx"
      to: "public/img/NamNamPizza&Grill.png"
      via: "ImageResponse with next/og renders source image at 32x32"
      pattern: "ImageResponse"
    - from: "src/app/apple-icon.tsx"
      to: "public/img/NamNamPizza&Grill.png"
      via: "ImageResponse with next/og renders source image at 180x180"
      pattern: "ImageResponse"
---

<objective>
Create `src/app/icon.tsx` and `src/app/apple-icon.tsx` using Next.js file-based icon convention with `ImageResponse` from `next/og` to programmatically generate the favicon (32x32) and Apple touch icon (180x180) from the existing logo PNG.

Purpose: Next.js auto-generates the correct `<link rel="icon">` and `<link rel="apple-touch-icon">` tags from files in `src/app/`, which is the recommended approach over `metadata.icons` config.
Output: Two TSX files that serve as build-time icon generators — no external image tools required.
</objective>

<execution_context>
@/Users/steffen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/steffen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-seo-and-meta/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create icon.tsx and apple-icon.tsx using ImageResponse</name>
  <files>
    src/app/icon.tsx
    src/app/apple-icon.tsx
  </files>
  <action>
Create two new files in `src/app/` using Next.js's file-based icon convention with `ImageResponse` from `next/og`. This approach requires no external image processing tools and is fully supported by the file convention.

**IMPORTANT:** Use `.tsx` (not `.png`) — the `ImageResponse` route approach generates icons at build/request time from code. Next.js recognizes both static PNG files and route-based TSX files for the icon convention.

**Source: https://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#generate-icons-using-code-js-ts-tsx**

**`src/app/icon.tsx`** (32x32 favicon):

```tsx
import { ImageResponse } from "next/og";

export const size = { width: 32, height: 32 };
export const contentType = "image/png";

export default function Icon() {
  return new ImageResponse(
    (
      <div
        style={{
          width: "100%",
          height: "100%",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
        }}
      >
        {/* eslint-disable-next-line @next/next/no-img-element */}
        <img
          src="https://namnam.no/img/NamNamPizza&Grill.png"
          width={32}
          height={32}
          alt=""
          style={{ objectFit: "contain" }}
        />
      </div>
    ),
    { ...size }
  );
}
```

**`src/app/apple-icon.tsx`** (180x180 Apple touch icon):

```tsx
import { ImageResponse } from "next/og";

export const size = { width: 180, height: 180 };
export const contentType = "image/png";

export default function AppleIcon() {
  return new ImageResponse(
    (
      <div
        style={{
          width: "100%",
          height: "100%",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
        }}
      >
        {/* eslint-disable-next-line @next/next/no-img-element */}
        <img
          src="https://namnam.no/img/NamNamPizza&Grill.png"
          width={180}
          height={180}
          alt=""
          style={{ objectFit: "contain" }}
        />
      </div>
    ),
    { ...size }
  );
}
```

**Note on image source URL:** The `ImageResponse` renderer (Satori) fetches images via URL — it does not resolve local filesystem paths. Use the absolute URL. During development, the icon routes render via Next.js dev server but the image fetch from `namnam.no` will work at build time. If the domain is not yet live, an alternative approach is to use the base64-encoded logo string directly — but using the absolute URL is the simplest path if deployment URL is confirmed. If the URL is unavailable, fallback: use a simple colored square with text "N" as placeholder:

```tsx
// Fallback if external URL is unavailable during build:
<div style={{
  width: "100%", height: "100%", background: "#e65c00",
  display: "flex", alignItems: "center", justifyContent: "center",
  color: "white", fontSize: size.width * 0.6, fontWeight: "bold",
  borderRadius: "20%"
}}>N</div>
```

Use the fallback if the image URL approach fails at build time (build error mentioning fetch or timeout).
  </action>
  <verify>
    <automated>cd /Users/steffen/Desktop/Projects/website_template && npm run build 2>&1 | tail -20</automated>
    <manual>After build: confirm no TypeScript errors in the two new files. In the built output, check that Next.js generates the icon link tags in the HTML head.</manual>
    <sampling_rate>run after this task</sampling_rate>
  </verify>
  <done>
    - `src/app/icon.tsx` exists with `size = { width: 32, height: 32 }`, `contentType = "image/png"`, and a default export returning `ImageResponse`
    - `src/app/apple-icon.tsx` exists with `size = { width: 180, height: 180 }`, `contentType = "image/png"`, and a default export returning `ImageResponse`
    - `npm run build` exits 0 with no TypeScript errors related to the new icon files
  </done>
</task>

</tasks>

<verification>
Run `npm run build` and confirm exit code 0. Check the generated HTML for icon link tags:
```bash
grep -r "apple-touch-icon\|rel=\"icon\"" /Users/steffen/Desktop/Projects/website_template/.next/server/app/ | head -5
```
</verification>

<success_criteria>
- `npm run build` passes without errors
- `src/app/icon.tsx` and `src/app/apple-icon.tsx` both exist with correct exports
- The browser tab favicon shows the Nam Nam logo (verified in Plan 03 checkpoint)
- Adding the page to iPhone home screen shows the Nam Nam logo (verified in Plan 03 checkpoint)
</success_criteria>

<output>
After completion, create `.planning/phases/04-seo-and-meta/04-02-SUMMARY.md`
</output>
