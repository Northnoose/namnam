---
phase: 02-navigation-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Navbar.tsx
autonomous: true
requirements: [NAV-01, NAV-02, NAV-03]

must_haves:
  truths:
    - "Desktop navbar shows logo and four section links (Om oss, Meny, Levering, Kontakt)"
    - "Desktop navbar phone button (41 23 22 19) is visible in the top-right and initiates tel: call"
    - "Navbar background is transparent at page top and transitions to solid dark on scroll past 50px"
    - "Mobile hamburger button toggles open/close of the mobile menu panel"
    - "Tapping a mobile menu link closes the panel and navigates to the anchor"
  artifacts:
    - path: "src/components/Navbar.tsx"
      provides: "Sticky, scroll-aware navbar with Headless UI v2 mobile menu"
      exports: ["Navbar"]
      min_lines: 60
  key_links:
    - from: "src/components/Navbar.tsx"
      to: "window.scrollY"
      via: "useEffect scroll listener with passive: true"
      pattern: "addEventListener.*scroll.*passive"
    - from: "src/components/Navbar.tsx"
      to: "@headlessui/react"
      via: "named v2 exports"
      pattern: "DisclosureButton|DisclosurePanel|CloseButton"
    - from: "CloseButton"
      to: "next/link Link"
      via: "as={Link} prop"
      pattern: "CloseButton.*as=\\{Link\\}"
---

<objective>
Rewrite Navbar.tsx for Phase 2: sticky top, transparent-to-solid scroll transition, Headless UI v2 named-export API, section links (Om oss, Meny, Levering, Kontakt), desktop phone CTA, and mobile menu with auto-close on link tap.

Purpose: NAV-01/02/03 are all implemented in Navbar.tsx. Grouping them into one plan avoids file conflicts and keeps related concerns together.
Output: A fully functional sticky navbar that is the primary navigation layer for the entire site.
</objective>

<execution_context>
@/Users/steffen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/steffen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-navigation-shell/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Navbar.tsx — sticky, scroll-aware, Headless UI v2, section links, desktop CTA, mobile auto-close</name>
  <files>src/components/Navbar.tsx</files>
  <action>
Replace the entire contents of `src/components/Navbar.tsx` with a new implementation. All requirements below are mandatory — do not omit any:

**Imports:**
```tsx
"use client";
import { useState, useEffect } from "react";
import Link from "next/link";
import Image from "next/image";
import { Disclosure, DisclosureButton, DisclosurePanel, CloseButton } from "@headlessui/react";
import ThemeChanger from "./DarkSwitch";
```

**Section data (replaces the `navigation` array):**
```tsx
const sections = [
  { id: "om-oss",  label: "Om oss" },
  { id: "meny",    label: "Meny" },
  { id: "levering", label: "Levering" },
  { id: "kontakt", label: "Kontakt" },
];
```

**Scroll detection (NAV-02):**
- `useState(false)` for `scrolled`
- `useEffect` that registers `window.addEventListener("scroll", handler, { passive: true })` and cleans up on unmount
- Handler: `setScrolled(window.scrollY > 50)` — flips boolean only, no raw pixel state

**Outer wrapper — sticky + transition (NAV-02):**
```tsx
<div className={`sticky top-0 z-50 w-full transition-colors duration-300 ${
  scrolled ? "bg-neutral-900/95 backdrop-blur-sm shadow-md" : "bg-transparent"
}`}>
```

**Inner nav — preserve existing responsive padding from Phase 1:**
```tsx
<nav className="container relative flex flex-wrap items-center justify-between px-4 py-4 lg:px-8 mx-auto">
```

**Logo (NAV-01) — keep 120px intrinsic, shrink to 60px on mobile for breathing room:**
```tsx
<Link href="/">
  <Image
    src="/img/NamNamPizza&Grill.png"
    alt="Nam Nam Pizza & Grill"
    width={120}
    height={120}
    priority
    className="w-[60px] h-auto lg:w-[80px]"
  />
</Link>
```

**Desktop links (NAV-01) — hidden on mobile, visible on lg+:**
```tsx
<ul className="hidden lg:flex items-center gap-1">
  {sections.map((s) => (
    <li key={s.id}>
      <Link
        href={`#${s.id}`}
        className="px-4 py-2 text-gray-200 hover:text-white rounded-md transition-colors duration-200"
      >
        {s.label}
      </Link>
    </li>
  ))}
</ul>
```

**Desktop phone CTA (NAV-04 desktop part) — rightmost on lg+:**
```tsx
<div className="hidden lg:flex items-center gap-3">
  <ThemeChanger />
  <a
    href="tel:+4741232219"
    className="flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white font-semibold rounded-md transition-colors duration-200"
    aria-label="Ring oss: 41 23 22 19"
  >
    41 23 22 19
  </a>
</div>
```

**Mobile controls — ThemeChanger + hamburger (visible below lg):**
```tsx
<div className="flex lg:hidden items-center gap-2">
  <ThemeChanger />
  <Disclosure>
    {({ open }) => (
      <>
        <DisclosureButton
          aria-label="Toggle Menu"
          className="px-2 py-1 text-gray-300 rounded-md hover:text-white focus:outline-none"
        >
          {/* Reuse existing SVG paths from original Navbar.tsx — hamburger when closed, X when open */}
          <svg className="w-6 h-6 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            {open ? (
              <path fillRule="evenodd" clipRule="evenodd"
                d="M18.278 16.864a1 1 0 0 1-1.414 1.414l-4.829-4.828-4.828 4.828a1 1 0 0 1-1.414-1.414l4.828-4.829-4.828-4.828a1 1 0 0 1 1.414-1.414l4.829 4.828 4.828-4.828a1 1 0 1 1 1.414 1.414l-4.828 4.829 4.828 4.828z" />
            ) : (
              <path fillRule="evenodd"
                d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z" />
            )}
          </svg>
        </DisclosureButton>

        <DisclosurePanel className="flex flex-col w-full py-2 lg:hidden">
          {sections.map((s) => (
            <CloseButton
              key={s.id}
              as={Link}
              href={`#${s.id}`}
              className="w-full px-4 py-3 text-gray-300 hover:text-white rounded-md transition-colors duration-200"
            >
              {s.label}
            </CloseButton>
          ))}
        </DisclosurePanel>
      </>
    )}
  </Disclosure>
</div>
```

**CRITICAL NOTES:**
- Do NOT use `Disclosure.Button` or `Disclosure.Panel` (Headless UI v1 dot-notation — deprecated). Use the v2 named exports shown above.
- The `CloseButton as={Link}` pattern closes the Disclosure panel automatically when a link is tapped — do not add manual `onClick` close handlers.
- `{ passive: true }` on the scroll listener is required — prevents blocking the main thread.
- Preserve the existing `px-4 py-4 lg:px-8` padding on the inner `<nav>` — established in Phase 1 and must not revert.
- Remove the old `navigation` array (Product, Features, Pricing, Company, Blog) entirely.
- Remove the old `[NAV_CTA_LABEL]` button — replaced by the phone CTA.
- ThemeChanger is retained on both desktop (inside the right cluster) and mobile (beside hamburger).
  </action>
  <verify>
    <automated>cd /Users/steffen/Desktop/Projects/website_template && npx tsc --noEmit 2>&1 | head -30</automated>
    <manual>
      Confirm in source: `Disclosure.Button` and `Disclosure.Panel` dot-notation do NOT appear.
      Confirm: `DisclosureButton`, `DisclosurePanel`, `CloseButton` named imports are present.
      Confirm: `sections` array has four entries (om-oss, meny, levering, kontakt).
      Confirm: scroll listener uses `{ passive: true }`.
      Confirm: outer div has `sticky top-0 z-50` classes.
    </manual>
  </verify>
  <done>
    TypeScript compiles with zero errors. Navbar.tsx uses Headless UI v2 named exports, has four section links, desktop phone CTA, scroll-aware background, and mobile Disclosure with CloseButton wrapping each link. No v1 dot-notation remains.
  </done>
</task>

</tasks>

<verification>
After the task completes:
1. `npx tsc --noEmit` exits with 0 errors
2. `grep -n "Disclosure\.Button\|Disclosure\.Panel" src/components/Navbar.tsx` returns no matches
3. `grep -n "DisclosureButton\|DisclosurePanel\|CloseButton" src/components/Navbar.tsx` returns matches for all three
4. `grep -n "sticky top-0" src/components/Navbar.tsx` returns a match
5. `grep -n "passive.*true\|true.*passive" src/components/Navbar.tsx` returns a match
</verification>

<success_criteria>
- Navbar.tsx uses Headless UI v2 named-export API (no dot-notation)
- Four section anchor links present (om-oss, meny, levering, kontakt)
- Scroll detection with passive listener and conditional Tailwind class
- Desktop phone link `tel:+4741232219` visible on lg+ screens
- Mobile Disclosure with CloseButton on each link
- TypeScript clean
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation-shell/02-01-SUMMARY.md` using the summary template.
</output>
